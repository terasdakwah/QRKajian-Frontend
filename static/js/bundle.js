"use strict";var e={},a=document.querySelector(".app__snackbar"),t=null;e.show=(e,o=4e3)=>{e&&(t&&t.remove(),(t=document.createElement("div")).className="app__snackbar-msg",t.textContent=e,a.appendChild(t),setTimeout((()=>{t.remove()}),o))};var o={};function n(e){!e&&window.isMediaStreamAPISupported?o.webcam=document.querySelector("video"):o.webcam=document.querySelector("img")}o.active=!1,o.webcam=null,o.canvas=null,o.ctx=null,o.decoder=null,o.setCanvas=()=>{o.canvas=document.createElement("canvas"),o.ctx=o.canvas.getContext("2d")},o.init=()=>{var a=!1;function t(){o.canvas.width=window.innerWidth,o.canvas.height=window.innerHeight}function i(e){navigator.mediaDevices.getUserMedia(e).then((function(e){o.webcam.srcObject=e,o.webcam.setAttribute("playsinline",!0),o.webcam.setAttribute("controls",!0),setTimeout((()=>{document.querySelector("video").removeAttribute("controls")}))})).catch((function(e){console.log("Error occurred ",e),d()}))}function d(){window.noCameraPermission=!0,document.querySelector(".custom-scanner").style.display="none",e.show("Unable to access the camera",1e4)}n(),o.setCanvas(),o.decoder=new Worker("decoder.js"),window.isMediaStreamAPISupported?o.webcam.addEventListener("play",(function(e){a||(t(),a=!0)}),!1):t(),window.isMediaStreamAPISupported&&navigator.mediaDevices.enumerateDevices().then((function(e){var a,t=e.filter((function(e){if(e.label.split(",")[1],"videoinput"==e.kind)return e}));t.length>1?(a={video:{mandatory:{sourceId:t[t.length-1].deviceId?t[t.length-1].deviceId:null}},audio:!1},window.iOS&&(a.video.facingMode="environment"),i(a)):t.length?(a={video:{mandatory:{sourceId:t[0].deviceId?t[0].deviceId:null}},audio:!1},window.iOS&&(a.video.facingMode="environment"),a.video.mandatory.sourceId||window.iOS?i(a):i({video:!0})):i({video:!0})})).catch((function(e){d(),console.error("Error occurred : ",e)}))},o.scan=function(e,a){function t(){if(o.active)try{o.ctx.drawImage(o.webcam,0,0,o.canvas.width,o.canvas.height);var e=o.ctx.getImageData(0,0,o.canvas.width,o.canvas.height);e.data&&o.decoder.postMessage(e)}catch(e){"NS_ERROR_NOT_AVAILABLE"==e.name&&setTimeout(t,0)}}o.active=!0,o.setCanvas(),o.decoder.onmessage=function(a){if(a.data.length>0){var n=a.data[0][2];o.active=!1,e(n)}setTimeout(t,0)},setTimeout((()=>{n(a)})),t()},window.addEventListener("DOMContentLoaded",(()=>{window.iOS=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0,window.isMediaStreamAPISupported=navigator&&navigator.mediaDevices&&"enumerateDevices"in navigator.mediaDevices,window.noCameraPermission=!1;var e=null,a=!1,t=document.querySelector(".custom-scanner"),n=document.querySelector(".app__scanner-img"),i=document.querySelector(".app__infouser"),d=document.querySelector(".app__infodialog"),r=document.querySelector(".app__infodialog-close"),s=document.querySelector(".app__infodialog-overlay"),c=document.querySelector(".app__dialog_result"),l=document.querySelector(".app__dialog_result-overlay"),u=document.querySelector("#scanresult");document.querySelector(".app__dialog_result-close").addEventListener("click",(function(){c.classList.add("app__dialog_result--hide"),l.classList.add("app__dialog_result--hide"),a?(window.isMediaStreamAPISupported||(e.src="",e.className=""),L()):(p.classList.remove("app__dialog_sedekah--hide"),m.classList.remove("app__dialog_sedekah--hide"))}),!1);var p=document.querySelector(".app__dialog_sedekah"),m=document.querySelector(".app__dialog_sedekah-overlay"),_=document.querySelector(".app__dialog_sedekah-yes"),v=document.querySelector(".app__dialog_sedekah-close");_.addEventListener("click",(function(){f();var e={token_id:token_id,sedekah:!0},a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};fetch("https://daftar.terasdakwah.com/apis/v1/user/sedekah",a).then((e=>{if(k(),!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{q()})).catch((e=>{console.error("Error:",e)}))}),!1),v.addEventListener("click",q,!1);var h=document.querySelector(".app__dialog_thanks"),w=document.querySelector(".app__dialog_thanks-overlay");document.querySelector(".app__dialog_thanks-close").addEventListener("click",(function(){h.classList.add("app__dialog_thanks--hide"),w.classList.add("app__dialog_thanks--hide"),window.isMediaStreamAPISupported||(e.src="",e.className="");L()}),!1);var y=document.querySelector("#username"),g=document.querySelector("#userpoin");window.appOverlay=document.querySelector(".app__overlay"),window.addEventListener("load",(e=>{o.init(),setTimeout((()=>{window.appOverlay.style.borderStyle="solid",window.isMediaStreamAPISupported&&L()}),1e3)})),r.addEventListener("click",(function(){d.classList.add("app__infodialog--hide"),s.classList.add("app__infodialog--hide")}),!1),i.addEventListener("click",(function(){d.classList.remove("app__infodialog--hide"),s.classList.remove("app__infodialog--hide")}),!1);const S=document.querySelector("#loading");function f(){S.classList.add("display"),setTimeout((()=>{S.classList.remove("display")}),1e4)}function k(){S.classList.remove("display")}function L(e=!1){window.isMediaStreamAPISupported&&!window.noCameraPermission&&(t.style.display="block",n.style.display="block"),e&&(t.style.display="block",n.style.display="block"),o.scan((e=>{t.style.display="none",n.style.display="none",f();var a={token_id:token_id,qr_data:e},o={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)};fetch("https://daftar.terasdakwah.com/apis/v1/attendance/fill",o).then((e=>{if(k(),!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{u.innerHTML=e.status,c.classList.remove("app__dialog_result--hide"),l.classList.remove("app__dialog_result--hide")})).catch((e=>{console.error("Error:",e)}))}),e),f();var i={token_id:token_id},d={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)};fetch("https://daftar.terasdakwah.com/apis/v1/user/data",d).then((e=>{if(k(),!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{y.innerHTML=e.data.name,g.innerHTML=e.data.poin,a=e.data.sedekah})).catch((e=>{console.error("Error:",e)}))}function q(){p.classList.add("app__dialog_sedekah--hide"),m.classList.add("app__dialog_sedekah--hide"),h.classList.remove("app__dialog_thanks--hide"),w.classList.remove("app__dialog_thanks--hide")}}));
